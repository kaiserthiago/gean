{% extends 'base.html' %}
{% block title %}Projetos{% endblock %}
{% block class_projeto %}active{% endblock %}
{% load filters %}

{% block breadcrumb_base %}
    <ol class="breadcrumb blue-grey lighten-4">
        <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
        <li class="breadcrumb-item"><a href="{% url 'projeto' %}">Projetos</a></li>
        <li class="breadcrumb-item active">Medições</li>
    </ol>
{% endblock %}

{% block content %}
    <div class="card mb-4">
        <div class="card-header grey lighten-1">
            <p class="font-weight-bold text-uppercase mb-0">
                Dados do Projeto
            </p>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-sm-8">
                    <table class="table table-borderless">
                        <tr>
                            <td colspan="2">
                                <span class="font-weight-bold">Autor: </span> {{ projeto.autor }}
                            </td>
                            <td>
                                <span class="font-weight-bold">Início: </span> {{ projeto.data_inicio }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="font-weight-bold">Descrição: </span> {{ projeto.descricao }}
                            </td>
                            <td>
                                <span class="font-weight-bold">Medições: </span> {{ projeto.get_medicoes.count }}
                            </td>
                            <td>
                                <span class="font-weight-bold">Situação: </span> {{ projeto.get_situacao_display }}
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="col-sm-4 mt-4">
                    <a style="cursor: not-allowed" class="btn primary-color-dark white-text" href="#">
                        <i class="fas fa-plus-circle mr-1 white-text"></i>Adicionar Medição
                    </a>

                    <a class="btn success-color-dark white-text" href="{% url 'projeto_importar' projeto.id %}">
                        <i class="fas fa-download mr-1 white-text"></i>Importar Medições
                    </a>

                </div>
            </div>
        </div>
    </div>

    {% if projeto.get_medicoes %}
        <div class="card mb-4">
            <div class="card-header grey lighten-1">
                <p class="font-weight-bold text-uppercase mb-0">
                    ESTATÍSTICAS DAS MEDIÇÕES
                </p>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-sm table-bordered table-hideable">
                        <thead style="background: lightgrey">
                        <tr>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                Elemento
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                N
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                X
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                Y
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                DP
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                DA
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                DPR (%)
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                Er (%)
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                En
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                Z
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                Z Horwitz
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                Zeta
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                Mediana
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>

                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                Variância
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>


                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                Valor Certificado
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>
                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                Incerteza Padrão
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>
                            <th scope="col" class="font-weight-bold" style="text-align: center;">
                                Incerteza Expandida
                                <a class="pull-right hide-column" data-toggle="tooltip"
                                   data-placement="bottom" title="Hide Column">
                                    <i class="fa fa-eye-slash"></i>
                                </a>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for media in media_concentracao %}
                            <tr>
                                <td style="text-align: center">
                                    {{ media.dados_elemento__elemento__simbolo }}
                                    {% if media.dados_elemento__tipo_concentracao == 1 %}
                                        <span class="red-text font-weight-bold">*</span>
                                    {% endif %}
                                </td>
                                <td style="text-align: center">{{ media.total }}</td>
                                <td style="text-align: center">{{ media.concentracao|floatformat:4 }}</td>
                                <td style="text-align: center">{{ media.incerteza_padrao|floatformat:4 }}</td>

                                {% for elemento, valor in desvio_padrao.items %}
                                    {% if elemento == media.dados_elemento__elemento__simbolo %}
                                        <td style="text-align: center">{{ valor|floatformat:4 }}</td>
                                    {% endif %}
                                {% endfor %}

                                <td style="text-align: center">{% diferenca_absoluta media.concentracao media.dados_elemento__concentracao %}</td>
                                <td style="text-align: center">{% dpr media.incerteza_padrao media.concentracao %}</td>
                                <td style="text-align: center">{% er media.concentracao media.dados_elemento__concentracao %}</td>
                                <td style="text-align: center">{% en media.concentracao media.dados_elemento__concentracao media.incerteza_padrao media.dados_elemento__incerteza_expandida %}</td>
                                <td style="text-align: center">{% z_score media.concentracao media.dados_elemento__concentracao media.dados_elemento__incerteza_expandida %}</td>
                                <td style="text-align: center">{% z_horwitz media.concentracao media.dados_elemento__concentracao media.dados_elemento__tipo_fracao_massa media.tipo_fracao_massa %}</td>
                                <td style="text-align: center">{% zeta_score media.concentracao media.dados_elemento__concentracao media.incerteza_padrao media.dados_elemento__incerteza_padrao %}</td>


                                {% for elemento, valor in mediana.items %}
                                    {% if elemento == media.dados_elemento__elemento__simbolo %}
                                        <td style="text-align: center">{{ valor|floatformat:4 }}</td>
                                    {% endif %}
                                {% endfor %}

                                {% for elemento, valor in variancia.items %}
                                    {% if elemento == media.dados_elemento__elemento__simbolo %}
                                        <td style="text-align: center">{{ valor|floatformat:4 }}</td>
                                    {% endif %}
                                {% endfor %}

                                <td style="text-align: center">{{ media.dados_elemento__concentracao|format }}</td>
                                <td style="text-align: center">{{ media.dados_elemento__incerteza_padrao|format }}</td>
                                <td style="text-align: center">{{ media.dados_elemento__incerteza_expandida|format }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                        <tfoot class="footer-restore-columns">
                        <tr>
                            <th colspan="4"><a class="restore-columns" href="#">Algumas colunas estão ocultas - Clique
                                aqui para exibí-las</a></th>
                        </tr>
                        </tfoot>
                    </table>
                </div>

                <hr>

                <p class="font-small">
                    * Tipo de Concentração Informada; N = Número de Determinações; X = Valor Médio; Y = Incerteza Padrão
                    Média; DP =
                    Desvio Padrão; DA = Diferença Absoluta; DPR(%) =
                    Desvio Padrão Relativo; Er(%) = Erro Relativo Percentual; En = Erro Normalizado; Z = Índice Z; Z
                    Horwitz
                    = Índice Z Aplicando Fator Horwitz; Zeta = Índice Zeta
                </p>
            </div>
        </div>
    {% endif %}

    <div class="card mb-4">
        <div class="card-header grey lighten-1">
            <p class="font-weight-bold text-uppercase mb-0">
                Medições do Projeto ({{ projeto.get_medicoes.count }})
            </p>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                    <tr>
                        <th scope="col">Certificado</th>
                        <th scope="col">Elemento</th>
                        <th scope="col" style="text-align: center">Data</th>
                        <th scope="col" style="text-align: center">Concentração</th>
                        <th scope="col" style="text-align: center">Incerteza Padrão</th>
                        <th scope="col" style="text-align: center">Incerteza Expandida</th>
                        <th scope="col" style="text-align: center">Incerteza Expandida Combinada</th>
                        <th scope="col" style="text-align: center">Intervalo de Confiança</th>
                        <th scope="col" style="text-align: center">Tipo de Fração de Massa</th>
                        <th scope="col" style="text-align: right">Ações</th>
                    </tr>
                    </thead>
                    <tbody id="myTable">
                    {% for medicao in projeto.get_medicoes %}
                        <tr>
                            <td>{{ medicao.dados_elemento.certificado.codigo }}</td>
                            <td>
                                {{ medicao.dados_elemento.elemento.simbolo }}
                                {% if medicao.dados_elemento.tipo_concentracao == 1 %}
                                    <span class="red-text font-weight-bold">*</span>
                                {% endif %}
                            </td>
                            <td style="text-align: center">{{ medicao.data|date:'d/m/Y' }}</td>
                            <td style="text-align: center">{{ medicao.concentracao_medicao }}</td>
                            <td style="text-align: center">{{ medicao.incerteza_padrao_medicao }}</td>
                            <td style="text-align: center">{{ medicao.incerteza_expandida_medicao }}</td>
                            <td style="text-align: center">{{ medicao.incerteza_expandida_combinada }}</td>
                            <td style="text-align: center">{{ medicao.intervalo_confianca_medicao }}</td>
                            <td style="text-align: center">{{ medicao.get_tipo_fracao_massa_display }}</td>
                            <td style="text-align: right; width: 10%">
                                <a data-toggle="modal" href="#Excluir{{ medicao.id }}"><i
                                        class="fas fa-trash mr-1 red-text" data-toggle="tooltip"
                                        title="Excluir"></i></a>
                            </td>

                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="9" class="alert alert-warning font-weight-bold">Não há medições para esse
                                projeto
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}

{% block modal %}
    {% for medicao in projeto.get_medicoes %}
        <!--Modal EXCLUIR-->
        <div class="modal fade" id="Excluir{{ medicao.id }}" tabindex="-1" role="dialog"
             aria-labelledby="myModalLabel"
             aria-hidden="true">
            <div class="modal-dialog modal-notify modal-danger" role="document">
                <!--Content-->
                <div class="modal-content">
                    <!--Header-->
                    <div class="modal-header text-center">
                        <h4 class="heading lead">Excluir</h4>
                        <button type="button" class="close" data-dismiss="modal"
                                aria-label="Close">
                            <span aria-hidden="true" class="white-text">&times;</span>
                        </button>
                    </div>
                    <form action="{% url 'medicao_delete' medicao.id projeto.id %}" method="POST">
                        <!--Body-->
                        <div class="modal-body text-center">
                            {% csrf_token %}
                            Tem certeza que deseja excluir?
                        </div>
                        <!--Footer-->
                        <div class="modal-footer justify-content-center">
                            <button type="submit" class="btn btn-danger waves-effect">Confirmar
                            </button>
                            <a type="button" class="btn btn-outline-danger waves-effect"
                               data-dismiss="modal">Voltar</a>
                        </div>
                    </form>
                </div>
                <!--/.Content-->
            </div>
        </div>
        <!--Fim Modal EXCLUIR-->
    {% endfor %}
{% endblock %}